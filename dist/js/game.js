import{Language as lang}from"../utils/language.js";import CreateDivFnc from"../utils/createDiv.js";import{ProbFnc}from"../utils/prob.js";import updateProps12 from"../utils/updateProps12.js";import Timer from"../utils/timer.js";import TimerCountDown from"../utils/timercountdown.js";import assets from"../utils/assetsmain.js";import makeSound from"../utils/makesound.js";const dqs=e=>document.querySelector(e),dqsa=e=>document.querySelectorAll(e),dce=e=>document.createElement(e),menu_wrap=dqs(".menu-wrap");let music,soundsToLoad=["./sounds/music.wav"],arrayToLoad=[].concat(soundsToLoad),waitVideo=document.querySelector("video"),wait=document.querySelector(".wait");assets.load(arrayToLoad).then((()=>{setTimeout((()=>{showPage()}),8e3)}));let menuActive={},params=getParams();function getParams(){let e=new URLSearchParams(window.location.search);return{menu:e.get("menu"),subMenu:e.get("subMenu")}}function checkMenuParams(){let e=menuActive.menu,n=menuActive.subMenu;return"form-0"!==e&&"form-1"!==e&&"form-2"!==e?(console.log("menu not good _-_-__--_____---_"),"Error in parameter form"):"item-0"!==n&&"item-1"!==n&&"item-2"!==n?(console.log("item not ok ++++++++++++++++++"),"Error in parameter item"):"OK"}menuActive.menu=params.menu,menuActive.subMenu=params.subMenu;const msgBlock=document.createElement("div");msgBlock.classList.add("msg-block"),document.body.append(msgBlock);let blockEverything=!1;const msg=document.querySelector(".message");function showPage(){const e=document.getElementsByTagName("html")[0];navigator.language||navigator.userLanguage;let n,t,o,r,i=!0,s=[],a=[],c=0,l=!1,d=!0,u=[],m=0;function p(){u=[],b.innerHTML=n.number+u.length,m=0}let L={anPos:!0,maxA:1,max:11},g={anPos:!0,maxA:1,max:11},v={},T=ProbFnc({max:6,numVar:["x"],nbrTerms:2,degArr:[1,0],anPos:!0});n=lang.LanguageFr.pagegame(),t=lang.LanguageFr.menu();CreateDivFnc({classes:["step-next","step-00","formDiv"],step:n.form});const f=CreateDivFnc({classes:["step-next","step-0","probDiv"],step:n.decompose});f.divEditor.contentEditable=!1;const M=CreateDivFnc({classes:["step-next","step-1"],step:n.gameStep}),h=document.querySelector(".toggler"),E=document.createElement("div"),H=document.createElement("div");H.classList.add("divHeader");const b=document.createElement("div");b.innerHTML=n.number+u.length;const w=document.querySelector(".information"),y=document.querySelector(".info-game-iframe"),k=document.createElement("div"),S=document.createElement("div");S.classList.add("clockMin");const _=document.createElement("div");_.classList.add("clockSec");const A=document.createElement("div");k.classList.add("clock"),k.append(S,_,A),H.append(b,k);const C=document.createElement("button"),P=document.createElement("button"),q=document.createElement("div"),x=document.createElement("div");x.classList.add("resume");const D=document.createElement("div");D.classList.add("sticky"),D.innerHTML=n.resumeHeaderTitle;const j=document.createElement("div");j.classList.add("clickToClose"),j.innerHTML=n.clickToClose,x.append(j,D);document.createElement("div"),document.createElement("div");const F=document.createElement("div"),O=(document.createElement("div"),document.querySelectorAll(".menu-item")),R=document.querySelector(".root");function B(){"option-1"===r?(S.innerHTML="02",_.innerHTML="00",A.innerHTML="00"):"option-2"===r?(S.innerHTML="05",_.innerHTML="00",A.innerHTML="00"):(S.innerHTML="00",_.innerHTML="00",A.innerHTML="00")}E.classList.add("divBtn"),C.innerHTML=n.button1,P.innerHTML=n.button2,E.append(P,C),function(e){a=[];for(let n=0;n<=e;n+=1)v=updateProps12(menuActive),L=v.props1,g=v.props2,T.genProb(L,g),a.push({probTxt:T.polyObj.finalHtmlReduce,respArr:T.step3Html})}(400);let N=()=>{console.log("Callback timer.")};function z(){f.divEditor.innerHTML=a[m++].probTxt,M.editor.resetDiv(),M.editor.setCaretPosition(0)}function J(){f.divEditor.innerHTML="",M.editor.resetDiv(),M.editor.setCaretPosition(0)}C.addEventListener("click",(function(e){return l=!0,C.innerHTML=n.button1_1,"option-1"===r||"option-2"===r?(o.isRunning()?(u.push(M.divEditor.innerHTML),b.innerHTML=n.number+u.length):(p(),o.reset(),o.start()),void z()):"option-3"!==r?"option-4"===r?(p(),void z()):void 0:void(o.isStarted()?o.isRunning()?(u.push(M.divEditor.innerHTML),b.innerHTML=n.number+u.length,J(),o.stop()):(p(),z(),o.start()):(o.reset(),p(),z(),o.start()))})),P.addEventListener("click",(function(){if("option-1"!==r&&"option-2"!==r)return"option-3"===r?(K(),o.reset(),o.stop(),void p()):void("option-4"===r&&(K(),p()));o.isRunning()?(u.push(M.divEditor.innerHTML),b.innerHTML=n.number+u.length,z()):K()})),e.style.fontSize=Math.floor(Math.min(window.innerWidth/768*150,200))+"%",window.addEventListener("resize",(function(n){e.style.fontSize=Math.floor(Math.min(window.innerWidth/768*150,200))+"%"}));let V=e=>{e.target.classList.toggle("active");let t=[],o=0;if(O.forEach((e=>{e.classList.forEach((n=>{"active"===n&&t.push(e.classList[1])}))})),t.forEach((e=>{"option-1"!==e&&"option-2"!==e&&"option-3"!==e&&"option-4"!==e||(o+=1)})),o>1)return e.target.classList.toggle("active"),msg.innerHTML=n.optionsOneSelection,msg.classList.add("show"),void setTimeout((()=>{msg.classList.remove("show")}),3e3);d=!0,t.forEach((e=>{"diff-prob"===e&&(d=!1)})),s=[...t]};function K(){if(l){c+=1;let e=document.createElement("table");e.classList.add("div-table");let t=e.createCaption();"option-1"===r&&(t.innerHTML=n.caption_01+n.tries+c+"<br>",t.innerHTML+=n.option_1_resume+u.length+"."),"option-2"===r&&(t.innerHTML=n.caption_02+n.tries+c+"<br>",t.innerHTML+=n.option_2_resume+u.length+"."),"option-3"===r&&(t.innerHTML=n.caption_03+n.tries+c+"<br>",t.innerHTML+=n.time_number+u.length+".<br>",t.innerHTML+=n.time+S.innerHTML+n.minute(S.innerHTML)+_.innerHTML+","+A.innerHTML+n.second(_.innerHTML)),"option-4"===r&&(t.innerHTML=n.caption_04+n.tries+c+"<br>",t.innerHTML+=n.numberProbTries+u.length);let o=e.createTHead(),i=n.colsHeader,s=o.insertRow();i.forEach(((e,n)=>{s.insertCell(n).innerHTML=e}));let d,m,p=e.createTBody(),L=[],g=0,v=0,T=0,f={prob:0,solution:0,enter:0,point:0};for(let e=0;e<Math.min(u.length,400);e+=1){f={prob:0,solution:0,enter:0,point:0},a[e].respArr.includes(u[e].split(" ").join("").toLowerCase())?(v+=1,g+=1,f.point="+1"):(T+=1,g-=1,f.point="-1");let n=document.createElement("ul");n.style.listStyleType="none";for(let t=0;t<a[e].respArr.length;t+=1){let o=document.createElement("li");o.style.listStyleType="none",o.innerHTML=a[e].respArr[t],n.append(o)}f.prob=a[e].probTxt,f.solution=n.innerHTML,f.enter=u[e],L.push(f)}L.forEach(((e,n)=>{d=p.insertRow(n),Object.values(e).forEach(((e,n)=>{m=d.insertCell(n),3===n&&(m.style.textAlign="center"),m.innerHTML=e}))}));let M=e.createTFoot().insertRow(0),h=M.insertCell(0);h.colSpan="2",h.rowSpan="2",h.innerHTML=n.cellFooter1(v)+v+"<br>"+n.cellFooter1_1(T)+T;let E=M.insertCell(1);E.rowSpan="2",E.innerHTML=n.cellFooter2,E.style.textAlign="center";let H=M.insertCell(2);H.rowSpan="2",H.innerHTML=v-T,H.style.textAlign="center",x.append(e),l=!1,J(),B()}x.classList.toggle("show"),d||W(a)}function W(e){for(let n=e.length-1;n>0;n-=1){const t=Math.floor(Math.random()*n),o=JSON.parse(JSON.stringify(e[n]));e[n]=JSON.parse(JSON.stringify(e[t])),e[t]=JSON.parse(JSON.stringify(o))}}O.forEach((e=>{e.addEventListener("click",V)})),w.addEventListener("click",(function(){y.classList.toggle("show")})),h.addEventListener("click",(function(){if(blockEverything)return void(h.checked=!1);if(i)return;if(o&&o.isRunning())return void(h.checked=!1);if(r=void 0,d=!0,s.forEach((e=>{"option-1"!==e&&"option-2"!==e&&"option-3"!==e&&"option-4"!==e||(r=e),"diff-prob"===e&&(d=!1)})),!r)return msg.innerHTML=n.optionsOneSelection,msg.classList.add("show"),setTimeout((()=>{msg.classList.remove("show")}),3e3),void h.click();"option-1"===r?o=TimerCountDown(N,10,(()=>{console.log("Error !!!!!!!!!!!!!!!!!!!!!!")}),S,_,A,2):"option-2"===r?o=TimerCountDown(N,10,(()=>{console.log("Error !!!!!!!!!!!!!!!!!!!!!!")}),S,_,A,5):"option-3"===r?o=Timer(N,10,(()=>{console.log("Error !!!!!!!!!!!!!!!!!!!!!!")}),S,_,A,15):"option-4"===r&&B();J(),h.ckecked||(c=0,x.querySelectorAll(".div-table").forEach((e=>{e.remove()})),u=[],b.innerHTML=n.number+u.length,W(a),m=0,C.innerHTML=n.button1)})),M.divEditor.addEventListener("keydown",(function(e){if("Enter"===e.key){if("option-4"===r){u.push(M.divEditor.innerHTML),b.innerHTML=n.number+u.length;let e=u[u.length-1].split(" ").join("").toLowerCase();return void(m>0&&a[m-1].respArr.includes(e)?z():P.click())}if(("option-1"===r||"option-2"===r)&&o.isRunning())return u.push(M.divEditor.innerHTML),b.innerHTML=n.number+u.length,void z();if("option-3"===r)return void(o.isStopped()?(p(),o.reset(),z(),o.start()):o.isRunning()?(o.stop(),u.push(M.divEditor.innerHTML),b.innerHTML=n.number+u.length,J()):l?(z(),o.start()):(p(),o.reset(),z(),o.start(),l=!0));if("option-4"===r)return u.push(M.divEditor.innerHTML),b.innerHTML=n.number+u.length,void z()}})),x.addEventListener("click",(function(){x.classList.toggle("show")})),R.append(H,f.div,M.div,q,E,F,x),h.click(),i=!1,waitVideo.pause(),waitVideo.currentTime=0,wait.style.display="none",menu_wrap.style.display="block"}window.addEventListener("load",(function(){"OK"!==checkMenuParams()&&(msgBlock.innerHTML=`Les paramètres de cette page ne sont pas conformes.<br>\n    Erreur: ${checkMenuParams()}<br>\n    Demandez de l'aide à votre administrateur réseau.\n    `,msgBlock.classList.add("show"),window.addEventListener("click",(function(){msg.innerHTML="Vous ne pouvez plus continuer tant que les erreurs ne seront pas réglées.<br>\n      Les paramètres de cette page ne sont pas conformes.<br>\n      Demandez de l'aide à votre administrateur réseau.\n      "})),blockEverything=!0)}));