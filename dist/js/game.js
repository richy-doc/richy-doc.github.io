import{Language as lang}from"../utils/language.js";import CreateDivFnc from"../utils/createDiv.js";import{ProbFnc}from"../utils/prob.js";import updateProps12 from"../utils/updateProps12.js";import Timer from"../utils/timer.js";import TimerCountDown from"../utils/timercountdown.js";import assets from"../utils/assetsmain.js";import makeSound from"../utils/makesound.js";const dqs=e=>document.querySelector(e),dqsa=e=>document.querySelectorAll(e),dce=e=>document.createElement(e),menu_wrap=dqs(".menu-wrap");let music,soundsToLoad=["./sounds/music.wav"],arrayToLoad=[].concat(soundsToLoad),waitVideo=document.querySelector("video"),wait=document.querySelector(".wait");assets.load(arrayToLoad).then((()=>{setTimeout((()=>{showPage()}),8e3)}));let menuActive={},params=getParams();function getParams(){let e=new URLSearchParams(window.location.search);return{menu:e.get("menu"),subMenu:e.get("subMenu")}}function checkMenuParams(){let e=menuActive.menu,t=menuActive.subMenu;return"form-0"!==e&&"form-1"!==e&&"form-2"!==e?(console.log("menu not good _-_-__--_____---_"),"Error in parameter form"):"item-0"!==t&&"item-1"!==t&&"item-2"!==t?(console.log("item not ok ++++++++++++++++++"),"Error in parameter item"):"OK"}menuActive.menu=params.menu,menuActive.subMenu=params.subMenu;const msgBlock=document.createElement("div");msgBlock.classList.add("msg-block"),document.body.append(msgBlock);let blockEverything=!1;const msg=document.querySelector(".message"),htmlEl=document.getElementsByTagName("html")[0],language=navigator.language||navigator.userLanguage;let page,menuList,timer,optionsInArr,optionActive,loading=!0,options=[],arrProb=[],nbrProb=400,tries=0,tryActive=!1,keepProb=!0,arrResStudent=[],probId=0;const nbrMinOption_1=2,nbrMinOption_2=5,maxTimeOption_3=15;function resetGameParams(){arrResStudent=[],divHeader1.innerHTML=page.number+arrResStudent.length,probId=0}let props={max:6,numVar:["x"],nbrTerms:2,degArr:[1,0],anPos:!0},props1={anPos:!0,maxA:1,max:11},props2={anPos:!0,maxA:1,max:11},props12={},prob=ProbFnc(props);const updateLanguage=()=>{page=lang.LanguageFr.pagegame(),menuList=lang.LanguageFr.menu()};page=lang.LanguageFr.pagegame(),menuList=lang.LanguageFr.menu();const formDiv=CreateDivFnc({classes:["step-next","step-00","formDiv"],step:page.form}),divProbTxt=CreateDivFnc({classes:["step-next","step-0","probDiv"],step:page.decompose});divProbTxt.divEditor.contentEditable=!1;const response=CreateDivFnc({classes:["step-next","step-1"],step:page.gameStep}),checkBox=document.querySelector(".toggler"),divBtn=document.createElement("div"),divHeader=document.createElement("div");divHeader.classList.add("divHeader");const divHeader1=document.createElement("div");divHeader1.innerHTML=page.number+arrResStudent.length;const infoGame=document.querySelector(".information"),infoIframe=document.querySelector(".info-game-iframe"),clock=document.createElement("div"),clockMin=document.createElement("div");clockMin.classList.add("clockMin");const clockSec=document.createElement("div");clockSec.classList.add("clockSec");const clockLeft=document.createElement("div");clock.classList.add("clock"),clock.append(clockMin,clockSec,clockLeft),divHeader.append(divHeader1,clock);const btn_start=document.createElement("button"),btn_show_resume=document.createElement("button"),step1DivMsg=document.createElement("div"),divResume=document.createElement("div");divResume.classList.add("resume");const resumeHeader=document.createElement("div");resumeHeader.classList.add("sticky"),resumeHeader.innerHTML=page.resumeHeaderTitle;const resumeClickToClose=document.createElement("div");resumeClickToClose.classList.add("clickToClose"),resumeClickToClose.innerHTML=page.clickToClose,divResume.append(resumeClickToClose,resumeHeader);const step2DivMsg=document.createElement("div"),step3DivMsg=document.createElement("div"),nextProbMsg=document.createElement("div"),heading=document.createElement("div"),menuItems=document.querySelectorAll(".menu-item"),app=document.querySelector(".root");function resetAll(){tries=0,divResume.querySelectorAll(".div-table").forEach((e=>{e.remove()})),arrResStudent=[],divHeader1.innerHTML=page.number+arrResStudent.length,shuffleProb(arrProb),probId=0,btn_start.innerHTML=page.button1}function genArrProb(e){console.log("IN gen prob"),arrProb=[];for(let t=0;t<=e;t+=1)props12=updateProps12(menuActive),props1=props12.props1,props2=props12.props2,prob.genProb(props1,props2),arrProb.push({probTxt:prob.polyObj.finalHtmlReduce,respArr:prob.step3Html})}function resetClock(){"option-1"===optionActive?(clockMin.innerHTML="02",clockSec.innerHTML="00",clockLeft.innerHTML="00"):"option-2"===optionActive?(clockMin.innerHTML="05",clockSec.innerHTML="00",clockLeft.innerHTML="00"):(clockMin.innerHTML="00",clockSec.innerHTML="00",clockLeft.innerHTML="00")}divBtn.classList.add("divBtn"),btn_start.innerHTML=page.button1,btn_show_resume.innerHTML=page.button2,divBtn.append(btn_show_resume,btn_start),genArrProb(nbrProb);let callbackTimer=()=>{console.log("Callback timer.")};function updateProbDiv(){divProbTxt.divEditor.innerHTML=arrProb[probId++].probTxt,response.editor.resetDiv(),response.editor.setCaretPosition(0)}function clearProbDiv(){divProbTxt.divEditor.innerHTML="",response.editor.resetDiv(),response.editor.setCaretPosition(0)}btn_start.addEventListener("click",(function(e){return tryActive=!0,btn_start.innerHTML=page.button1_1,"option-1"===optionActive||"option-2"===optionActive?(timer.isRunning()?(arrResStudent.push(response.divEditor.innerHTML),divHeader1.innerHTML=page.number+arrResStudent.length):(resetGameParams(),timer.reset(),timer.start()),void updateProbDiv()):"option-3"!==optionActive?"option-4"===optionActive?(resetGameParams(),void updateProbDiv()):void 0:void(timer.isStarted()?timer.isRunning()?(arrResStudent.push(response.divEditor.innerHTML),divHeader1.innerHTML=page.number+arrResStudent.length,clearProbDiv(),timer.stop()):(resetGameParams(),updateProbDiv(),timer.start()):(timer.reset(),resetGameParams(),updateProbDiv(),timer.start()))})),btn_show_resume.addEventListener("click",(function(){if("option-1"!==optionActive&&"option-2"!==optionActive)return"option-3"===optionActive?(showResumeTableV3(),timer.reset(),timer.stop(),void resetGameParams()):void("option-4"===optionActive&&(showResumeTableV3(),resetGameParams()));timer.isRunning()?(arrResStudent.push(response.divEditor.innerHTML),divHeader1.innerHTML=page.number+arrResStudent.length,updateProbDiv()):showResumeTableV3()})),htmlEl.style.fontSize=Math.floor(Math.min(window.innerWidth/768*150,200))+"%",window.addEventListener("resize",(function(e){htmlEl.style.fontSize=Math.floor(Math.min(window.innerWidth/768*150,200))+"%"}));let menuListener=e=>{e.target.classList.toggle("active");let t=[],r=0;if(menuItems.forEach((e=>{e.classList.forEach((r=>{"active"===r&&t.push(e.classList[1])}))})),t.forEach((e=>{"option-1"!==e&&"option-2"!==e&&"option-3"!==e&&"option-4"!==e||(r+=1)})),r>1)return e.target.classList.toggle("active"),msg.innerHTML=page.optionsOneSelection,msg.classList.add("show"),void setTimeout((()=>{msg.classList.remove("show")}),3e3);keepProb=!0,t.forEach((e=>{"diff-prob"===e&&(keepProb=!1)})),options=[...t]};function addListernerForms(){menuItems.forEach((e=>{e.addEventListener("click",menuListener)}))}function updateOptionsTimer(){if(blockEverything)checkBox.checked=!1;else if(!loading)if(timer&&timer.isRunning())checkBox.checked=!1;else{if(optionActive=void 0,keepProb=!0,options.forEach((e=>{"option-1"!==e&&"option-2"!==e&&"option-3"!==e&&"option-4"!==e||(optionActive=e),"diff-prob"===e&&(keepProb=!1)})),!optionActive)return msg.innerHTML=page.optionsOneSelection,msg.classList.add("show"),setTimeout((()=>{msg.classList.remove("show")}),3e3),void checkBox.click();"option-1"===optionActive?timer=TimerCountDown(callbackTimer,10,(()=>{console.log("Error !!!!!!!!!!!!!!!!!!!!!!")}),clockMin,clockSec,clockLeft,2):"option-2"===optionActive?timer=TimerCountDown(callbackTimer,10,(()=>{console.log("Error !!!!!!!!!!!!!!!!!!!!!!")}),clockMin,clockSec,clockLeft,5):"option-3"===optionActive?timer=Timer(callbackTimer,10,(()=>{console.log("Error !!!!!!!!!!!!!!!!!!!!!!")}),clockMin,clockSec,clockLeft,15):"option-4"===optionActive&&resetClock(),clearProbDiv(),checkBox.ckecked||resetAll()}}function showResumeTableV3(){if(tryActive){tries+=1;let e=document.createElement("table");e.classList.add("div-table");let t=e.createCaption();"option-1"===optionActive&&(t.innerHTML=page.caption_01+page.tries+tries+"<br>",t.innerHTML+=page.option_1_resume+arrResStudent.length+"."),"option-2"===optionActive&&(t.innerHTML=page.caption_02+page.tries+tries+"<br>",t.innerHTML+=page.option_2_resume+arrResStudent.length+"."),"option-3"===optionActive&&(t.innerHTML=page.caption_03+page.tries+tries+"<br>",t.innerHTML+=page.time_number+arrResStudent.length+".<br>",t.innerHTML+=page.time+clockMin.innerHTML+page.minute(clockMin.innerHTML)+clockSec.innerHTML+","+clockLeft.innerHTML+page.second(clockSec.innerHTML)),"option-4"===optionActive&&(t.innerHTML=page.caption_04+page.tries+tries+"<br>",t.innerHTML+=page.numberProbTries+arrResStudent.length);let r=e.createTHead(),n=page.colsHeader,o=r.insertRow();n.forEach(((e,t)=>{o.insertCell(t).innerHTML=e}));let i,s,a=e.createTBody(),c=[],l=0,d=0,p=0,m={prob:0,solution:0,enter:0,point:0};for(let e=0;e<Math.min(arrResStudent.length,nbrProb);e+=1){m={prob:0,solution:0,enter:0,point:0},arrProb[e].respArr.includes(arrResStudent[e].split(" ").join("").toLowerCase())?(d+=1,l+=1,m.point="+1"):(p+=1,l-=1,m.point="-1");let t=document.createElement("ul");t.style.listStyleType="none";for(let r=0;r<arrProb[e].respArr.length;r+=1){let n=document.createElement("li");n.style.listStyleType="none",n.innerHTML=arrProb[e].respArr[r],t.append(n)}m.prob=arrProb[e].probTxt,m.solution=t.innerHTML,m.enter=arrResStudent[e],c.push(m)}c.forEach(((e,t)=>{i=a.insertRow(t),Object.values(e).forEach(((e,t)=>{s=i.insertCell(t),3===t&&(s.style.textAlign="center"),s.innerHTML=e}))}));let u=e.createTFoot().insertRow(0),v=u.insertCell(0);v.colSpan="2",v.rowSpan="2",v.innerHTML=page.cellFooter1(d)+d+"<br>"+page.cellFooter1_1(p)+p;let g=u.insertCell(1);g.rowSpan="2",g.innerHTML=page.cellFooter2,g.style.textAlign="center";let b=u.insertCell(2);b.rowSpan="2",b.innerHTML=d-p,b.style.textAlign="center",divResume.append(e),tryActive=!1,clearProbDiv(),resetClock()}divResume.classList.toggle("show"),keepProb||shuffleProb(arrProb)}function shuffleProb(e){for(let t=e.length-1;t>0;t-=1){const r=Math.floor(Math.random()*t),n=JSON.parse(JSON.stringify(e[t]));e[t]=JSON.parse(JSON.stringify(e[r])),e[r]=JSON.parse(JSON.stringify(n))}}function showPage(){app.append(divHeader,divProbTxt.div,response.div,step1DivMsg,divBtn,nextProbMsg,divResume),checkBox.click(),loading=!1,waitVideo.pause(),waitVideo.currentTime=0,wait.style.display="none",menu_wrap.style.display="block"}addListernerForms(),infoGame.addEventListener("click",(function(){infoIframe.classList.toggle("show")})),checkBox.addEventListener("click",updateOptionsTimer),response.divEditor.addEventListener("keydown",(function(e){if("Enter"===e.key){if("option-4"===optionActive){arrResStudent.push(response.divEditor.innerHTML),divHeader1.innerHTML=page.number+arrResStudent.length;let e=arrResStudent[arrResStudent.length-1].split(" ").join("").toLowerCase();return void(probId>0&&arrProb[probId-1].respArr.includes(e)?updateProbDiv():btn_show_resume.click())}if(("option-1"===optionActive||"option-2"===optionActive)&&timer.isRunning())return arrResStudent.push(response.divEditor.innerHTML),divHeader1.innerHTML=page.number+arrResStudent.length,void updateProbDiv();if("option-3"===optionActive)return void(timer.isStopped()?(resetGameParams(),timer.reset(),updateProbDiv(),timer.start()):timer.isRunning()?(timer.stop(),arrResStudent.push(response.divEditor.innerHTML),divHeader1.innerHTML=page.number+arrResStudent.length,clearProbDiv()):tryActive?(updateProbDiv(),timer.start()):(resetGameParams(),timer.reset(),updateProbDiv(),timer.start(),tryActive=!0));if("option-4"===optionActive)return arrResStudent.push(response.divEditor.innerHTML),divHeader1.innerHTML=page.number+arrResStudent.length,void updateProbDiv()}})),divResume.addEventListener("click",(function(){divResume.classList.toggle("show")}));