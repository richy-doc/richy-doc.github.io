import CreateDivFnc from"../utils/createDiv.js";import{ProbFnc}from"../utils/prob.js";import msg from"../utils/messages.js";import{Language as lang}from"../utils/language.js";import updateCanvas from"../utils/updateCanvas.js";import updateProps12 from"../utils/updateProps12.js";import assets from"../utils/assetsmain.js";import makeSound from"../utils/makesound.js";let music,imagesToLoad=["./images/image_0.png","./images/image_1.png","./images/image_2.png","./images/image_3.png","./images/image_4.png","./images/image_5.png","./images/cadenas_close_200x400.png","./images/cadenas_open_200x400.png","./images/lights_all_off.png","./images/lights_green_on.png","./images/lights_red_on.png","./images/lights_yellow_on.png","./images/lights_all_on.png"],soundsToLoad=["./sounds/music.wav"],arrayToLoad=imagesToLoad.concat(soundsToLoad);function clgAsset(){console.log("Asset is =",assets),console.log("Asset is =",assets["./images/lights_red_on.png"]),console.log("Asset wav is =",assets["./sounds/music.wav"]),music=assets["./sounds/music.wav"],console.log("music actx state=",music.actx.state)}function showPage(){music=assets["./sounds/music.wav"];const e="url("+assets["./images/lights_red_on.png"].src+")",s="url("+assets["./images/lights_all_off.png"].src+")",t="url("+assets["./images/lights_green_on.png"].src+")",i="url("+assets["./images/lights_yellow_on.png"].src+")",n="url("+assets["./images/lights_all_on.png"].src+")",r="url("+assets["./images/cadenas_open_200x400.png"].src+")",a="url("+assets["./images/cadenas_close_200x400.png"].src+")",o=document.getElementsByTagName("html")[0],d=window.getComputedStyle(o,null).getPropertyValue("font-size"),l=(parseFloat(d),document.querySelector(".locked")),c=document.querySelector(".lights");let m=0,u=0;l.addEventListener("click",(e=>{!function(){let e=N.menu,s=N.subMenu,t=new URLSearchParams;t.append("menu",e),t.append("subMenu",s);window.open("game.html?"+t)}(),m>=5&&window.open("game.html")})),o.style.fontSize=Math.floor(Math.min(window.innerWidth/768*150,200))+"%";let g=document.getElementById("canvasId"),p=g.getContext("2d");g.width=window.innerWidth,g.height=window.innerHeight,window.addEventListener("resize",(function(e){o.style.fontSize=Math.floor(Math.min(window.innerWidth/768*150,200))+"%",g.width=window.innerWidth,g.height=window.innerHeight,updateCanvas(p,J,window.innerWidth,window.innerHeight)}));navigator.language||navigator.userLanguage;let L,v;L=lang.LanguageFr.page(),v=lang.LanguageFr.menu();const h=CreateDivFnc({classes:["step-next","step-00","formDiv"],step:L.form}),b=CreateDivFnc({classes:["step-next","step-0","probDiv"],step:L.decompose}),f=CreateDivFnc({classes:["step-next","step-1"],step:L.step1}),_=CreateDivFnc({classes:["step-next","step-2"],step:L.step2}),w=CreateDivFnc({classes:["step-next","step-3"],step:L.step3}),H=CreateDivFnc({classes:["step-next","step-button"],step:""}),E=document.querySelector(".info"),T=document.querySelector(".about"),M=document.querySelector(".info-click"),y=document.querySelector(".about-click"),k=document.querySelector(".toggler"),C=document.createElement("div"),P=document.createElement("button"),x=document.createElement("div"),S=document.createElement("div"),D=document.createElement("div"),F=document.createElement("div"),j=document.createElement("div"),q=document.querySelectorAll(".sub-menu-div"),I=document.querySelectorAll(".sub-menu"),A=document.querySelectorAll(".has-sub-menu"),W=document.querySelector(".root");C.classList.add("divBtn"),P.innerHTML=L.button,C.append(P);let O=["(x+b<sub>1</sub>)(x+b<sub>2</sub>)","(a<sub>1</sub>x+b<sub>1</sub>)(a<sub>2</sub>x+b<sub>2</sub>)","(x<sup>n</sup>+b<sub>1</sub>)(x<sup>n</sup>+b<sub>2</sub>)","(a<sub>1</sub>x<sup>n</sup>+b<sub>1</sub>)(a<sub>2</sub>x<sup>n</sup>+b<sub>2</sub>)"],z=0;document.title=L.title,document.querySelector(".menu-item.info-click").innerHTML=v.menu0,document.querySelector(".menu-item.about-click").innerHTML=v.menu1;let B={anPos:!0,maxA:1,max:11},R={anPos:!0,maxA:1,max:11},V={},$=ProbFnc({max:6,numVar:["x"],nbrTerms:2,degArr:[1,0],anPos:!0});$.genProb(B,R);let N={menu:"form-0",subMenu:"item-0"},U=()=>{b.divEditor.innerHTML=$.polyObj.finalHtmlReduce,h.divEditor.innerHTML=O[z],f.editor.resetDiv(),_.editor.resetDiv(),w.editor.resetDiv(),f.divEditor.innerHTML=$.step1Html[0],_.divEditor.innerHTML=$.step2Html[0],w.divEditor.innerHTML=$.step3Html[0],f.divEditor.focus(),f.editor.setCaretPosition(0)},G=e=>{let s=e.menu,t=e.subMenu;"form-0"===s?z=0:"form-1"===s?z=1:"form-2"===s?z=2:"form-3"===s&&(z=3),I.forEach((e=>{e.classList.remove("active"),e.classList[1]===s&&e.classList[2]===t&&(e.classList.add("active"),k.checked&&(k.checked=!1))})),V=updateProps12(e),B=V.props1,R=V.props2,$.genProb(B,R)};N&&G(N),h.divEditor.contentEditable=!1,h.divEditor.innerHTML=O[z],H.divEditor.contentEditable,b.divEditor.contentEditable=!1,b.divEditor.innerHTML=$.polyObj.finalHtmlOrder,M.addEventListener("click",(()=>{E.classList.toggle("show")})),y.addEventListener("click",(()=>{T.classList.toggle("show")})),x.classList.add("message"),x.classList.add("hidden"),S.classList.add("message"),S.classList.add("hidden"),D.classList.add("message"),D.classList.add("hidden"),F.classList.add("message"),F.classList.add("hidden"),F.classList.add("success"),j.textContent="My AI exerciser",j.classList.add("heading");let J=[];for(let e=0;e<=5;e+=1)J.push(assets[`./images/image_${e}.png`]);let K=o=>{if(void 0===o.target)return;if("btn"===o.target){if($.step_1_done&&$.step_2_done&&$.step_3_done)return 0===u?(m+=1,l.innerHTML=m):m>0&&(m-=1,l.innerHTML=m),m>=5?(l.style.backgroundImage=r,l.style.cursor="pointer"):(l.style.backgroundImage=a,l.style.cursor=""),u=0,updateCanvas(p,J,window.innerWidth,window.innerHeight),V=updateProps12(N),B=V.props1,R=V.props2,$.genProb(B,R),F.innerHTML=msg.success(),F.classList.remove("hidden"),setTimeout((()=>{F.classList.add("hidden")}),3e3),b.divEditor.innerHTML=$.polyObj.finalHtmlReduce,f.editor.resetDiv(),_.editor.resetDiv(),w.editor.resetDiv(),f.editor.setCaretPosition(0),void U();if(!$.step_1_done)return void f.editor.setCaretPosition(0);if(!$.step_2_done)return void _.editor.setCaretPosition(0);if(!$.step_3_done)return void w.editor.setCaretPosition(0)}x.innerHTML="",x.classList.add("hidden"),x.classList.remove("error"),x.classList.remove("warning"),x.classList.remove("special"),S.innerHTML="",S.classList.add("hidden"),S.classList.remove("error"),S.classList.remove("warning"),S.classList.remove("special"),D.innerHTML="",D.classList.add("hidden"),D.classList.remove("error"),D.classList.remove("warning"),D.classList.remove("special");let d="",g="";if(g=o.target,"step-1"===g){if(d=f.editor.getHtmlForm(),""===d)return void f.editor.setCaretPosition(0)}else if("step-2"===g){if(d=_.editor.getHtmlForm(),""===d)return void _.editor.setCaretPosition(0)}else{if("step-3"!==g)return void console.log("error in blur method==================");if(d=w.editor.getHtmlForm(),""===d)return void w.editor.setCaretPosition(0)}let L=$.analyseStudentInput(d,g);if(L.special)if(c.style.backgroundImage=n,setTimeout((()=>{c.style.backgroundImage=s}),2e3),"step-1"===g)x.innerHTML=L.special,x.classList.add("special"),x.classList.remove("hidden"),f.divEditor.focus();else if("step-2"===g)S.innerHTML=L.special,S.classList.add("special"),S.classList.remove("hidden"),_.divEditor.focus();else{if("step-3"!==g)return void console.log("error in update click fnc ==================");D.innerHTML=L.special,D.classList.add("special"),D.classList.remove("hidden"),w.divEditor.focus()}else if(""===L.error){let e=L.result.find;if("step-1"===e?($.step_1_done=!0,f.divEditor.innerHTML=L.studentObj.chainHtml):"step-2"===e?($.step_2_done=!0,_.divEditor.innerHTML=L.studentObj.chainHtml):"step-3"===e&&($.step_3_done=!0,w.divEditor.innerHTML=L.studentObj.chainHtml),e===g?$.step_1_done?$.step_2_done?$.step_3_done?P.focus():w.editor.setCaretPosition(0):_.editor.setCaretPosition(0):f.editor.setCaretPosition(0):"step-1"===g?(f.divEditor.innerHTML="",f.editor.setCaretPosition(0)):"step-2"===g?(_.divEditor.innerHTML="",_.editor.setCaretPosition(0)):"step-3"===g&&(w.divEditor.innerHTML="",w.editor.setCaretPosition(0)),""!==L.msg)if(c.style.backgroundImage=i,setTimeout((()=>{c.style.backgroundImage=s}),2e3),"step-1"===e)x.innerHTML=L.msg,x.classList.add("warning"),x.classList.remove("hidden");else if("step-2"===e)S.innerHTML=L.msg,S.classList.add("warning"),S.classList.remove("hidden");else{if("step-3"!==e)return void console.log("error in blur method==================");D.innerHTML=L.msg,D.classList.add("warning"),D.classList.remove("hidden")}else c.style.backgroundImage=t,setTimeout((()=>{c.style.backgroundImage=s}),2e3)}else if(u+=1,c.style.backgroundImage=e,setTimeout((()=>{c.style.backgroundImage=s}),2e3),"step-1"===g)x.innerHTML=L.error,x.classList.add("error"),x.classList.remove("hidden"),f.divEditor.focus();else if("step-2"===g)S.innerHTML=L.error,S.classList.add("error"),S.classList.remove("hidden"),_.divEditor.focus();else{if("step-3"!==g)return void console.log("error in update click fnc ==================");D.innerHTML=L.error,D.classList.add("error"),D.classList.remove("hidden"),w.divEditor.focus()}},Q=e=>{let s=e.target.classList[1];"step-1"===s||("step-2"===s?$.step_1_done||K({target:"step-1"}):"step-3"===s&&($.step_1_done?$.step_2_done||K({target:"step-2"}):K({target:"step-1"})))};f.divEditor.addEventListener("click",Q),_.divEditor.addEventListener("click",Q),w.divEditor.addEventListener("click",Q);document.body.addEventListener("keydown",(e=>{x.innerHTML="",x.classList.add("hidden"),x.classList.remove("error"),x.classList.remove("warning"),x.classList.remove("special"),S.innerHTML="",S.classList.add("hidden"),S.classList.remove("error"),S.classList.remove("warning"),S.classList.remove("special"),D.innerHTML="",D.classList.add("hidden"),D.classList.remove("error"),D.classList.remove("warning"),D.classList.remove("special"),"Enter"===e.key&&K({target:e.target.classList[1]})})),P.addEventListener("click",(e=>{$.step_1_done?$.step_2_done?$.step_3_done?(x.innerHTML="",x.classList.add("hidden"),x.classList.remove("error"),x.classList.remove("warning"),x.classList.remove("special"),S.innerHTML="",S.classList.add("hidden"),S.classList.remove("error"),S.classList.remove("warning"),S.classList.remove("special"),D.innerHTML="",D.classList.add("hidden"),D.classList.remove("error"),D.classList.remove("warning"),D.classList.remove("special"),K({target:"btn"})):K({target:"step-3"}):K({target:"step-2"}):K({target:"step-1"})})),f.divEditor.innerHTML=$.step1Html[0],_.divEditor.innerHTML=$.step2Html[0],w.divEditor.innerHTML=$.step3Html[0];let X=e=>{let s=e.target.classList[1],t=e.target.classList[2];N.menu=s,N.subMenu=t,G(N),U()},Y=e=>{if("has-sub-menu"===e.target.classList[0]){q.forEach((e=>{e.classList.remove("active")})),A.forEach((e=>{e.classList.remove("active")})),e.target.classList.add("active");let s=e.target.querySelector(`.sub-menu-div.${e.target.classList[1]}`);null!=s&&s.classList.add("active")}};I.forEach((e=>{e.addEventListener("click",X)})),A.forEach((e=>{e.addEventListener("click",Y)})),W.append(h.div,b.div,f.div,x,_.div,S,w.div,D,C,F),window.addEventListener("load",(function(){updateCanvas(p,J,window.innerWidth,window.innerHeight)})),updateCanvas(p,J,window.innerWidth,window.innerHeight),f.divEditor.focus(),f.editor.setCaretPosition(0)}assets.load(arrayToLoad).then((()=>showPage()));