import errors from"./errors.js";let supOpen="«",supClose="»";function isDigit(r){return/[-+\d]/.test(r)}function isLetter(r){return/[a-zA-Z]/.test(r)}function reduceHtml(r){let e="";e=r,e=e.replace(/&nbsp;/g,""),e=e.replace(/\s/g,"");let t="";for(;t!==e;)t=e,e=e.split("--").join("+"),e=e.split("++").join("+"),e=e.split("+-").join("-"),e=e.split("-+").join("-");return t}function htmlToTerm(r,e=!1){let t="",n="",o="",l={},a="",i=!1,f=[];if(l.error="",t=reduceHtml(r),0===t.length)return{error:errors.empty_term()};t=t.replace(/<sup>/gi,supOpen),t=t.replace(/<\/sup>/gi,supClose);let s=t.split("");return s.forEach(((r,e)=>{r===supOpen?i=!0:s[e-1]===supClose&&(i=!1,""!==o?(isNaN(Number(o))&&(l.error=errors.error_exponent(o)),f.push({variable:a,exponent:Number(o)})):f.push({variable:a,exponent:1}),o="",a=""),i?r!==supOpen&&r!==supClose&&(o+=r):isDigit(r)?n+=r:isLetter(r)&&(""!==a?(""!==o?(isNaN(Number(o))&&(l.error=errors.error_exponent(o)),f.push({variable:a,exponent:Number(o)})):f.push({variable:a,exponent:1}),a=r,o=""):(a=r,o=""))})),""!==a&&(""!==o?(isNaN(Number(o))&&(l.error=errors.error_exponent(o)),f.push({variable:a,exponent:Number(o)})):f.push({variable:a,exponent:1})),""===n&&0===f.length&&""===o&&(l.error=errors.empty_char()),""===n&&0===f.length&&""!==o?(l.expo=!0,l.coeff=Number(o),l.varArr=[{variable:"x",exponent:0}],l.coeff>10&&(l.greater10=!0),l):("-"===n&&(e&&0===f.length?l.error=errors.empty_term():n=-1),0===f.length&&f.push({variable:"x",exponent:0}),""!==n&&"+"!==n||(n=1),l.coeff=Number(n),l.varArr=f,l)}function termToHtml(r){let e="";if(0===r.coeff)return"0";1!==r.coeff&&(-1===r.coeff?e+="-":e+=r.coeff.toString());for(let t=0;t<r.varArr.length;t++){let n=r.varArr[t];0!==n.exponent&&(1===n.exponent?e+=`${n.variable}`:e+=`${n.variable}<sup>${n.exponent}</sup>`)}return"-"===e&&(e="-1"),""===e&&(e="1"),e}function mulTerms(r,e){let t=copyTerm(r),n=copyTerm(e),o={coeff:t.coeff*n.coeff,varArr:[]};if(t.varArr.forEach((r=>{let e={variable:r.variable,exponent:r.exponent},t=[];n.varArr.forEach(((n,o)=>{n.variable===r.variable&&(e.exponent+=n.exponent,t.push(o))})),t.length>0&&Object.keys(t).reverse().forEach((r=>{n.varArr.splice(t[r],1)})),o.varArr.push(e)})),n.varArr.length)for(let r=0;r<n.varArr.length;r++)o.varArr.push(n.varArr[r]);return o}function addTerms(r,e){let t=copyTerm(r),n=copyTerm(e),o={coeff:null,varArr:[]},l=[];return isTermsEquivalent(t,n)?(o.coeff=t.coeff+n.coeff,o.varArr=t.varArr,l.push(o)):(l.push(t),l.push(n)),l}function copyTerm(r){let e={};e.coeff=r.coeff,e.varArr=[];for(let t=0;t<r.varArr.length;t++)e.varArr.push({...r.varArr[t]});return e}function isTermsEqual(r,e){let t=copyTerm(r),n=copyTerm(e);if(t.coeff!==n.coeff)return!1;if(t.varArr.length!==n.varArr.length)return!1;for(let r=0;r<t.varArr.length;r++){let e=t.varArr[r],o=!1;for(let r=0;r<n.varArr.length;r++){let t=n.varArr[r];JSON.stringify(e)===JSON.stringify(t)&&(o=!0)}if(!o)return!1}for(let r=0;r<n.varArr.length;r++){let e=n.varArr[r],o=!1;for(let r=0;r<t.varArr.length;r++){let n=t.varArr[r];JSON.stringify(e)===JSON.stringify(n)&&(o=!0)}if(!o)return!1}return!0}function isTermsEquivalent(r,e){let t=copyTerm(r),n=copyTerm(e);for(let r=0;r<t.varArr.length;r++){let e=t.varArr[r],o=!1;for(let r=0;r<n.varArr.length;r++){let t=n.varArr[r];JSON.stringify(e)===JSON.stringify(t)&&(o=!0)}if(!o)return!1}for(let r=0;r<n.varArr.length;r++){let e=n.varArr[r],o=!1;for(let r=0;r<t.varArr.length;r++){let n=t.varArr[r];JSON.stringify(e)===JSON.stringify(n)&&(o=!0)}if(!o)return!1}return!0}function orderTermVariables(r){let e=copyTerm(r);return e.varArr.sort(((r,e)=>r.variable<e.variable?-1:r.variable>e.variable?1:0)),e}function reduceTerm(r){let e=copyTerm(r);if(1===e.varArr.length)return e;let t={};t.coeff=e.coeff;let n=[],o=JSON.parse(JSON.stringify(e.varArr));n.push(o[0]);for(let r=1;r<o.length;r+=1){let e=o[r],t=n.findIndex((r=>r.variable===e.variable));-1!==t?n[t].exponent+=e.exponent:n.push(e)}return t.varArr=n,orderTermVariables(t)}const TermsFnc=r=>{let e=void 0===r.deg?1:r.deg,t=r.min||1,n=r.max||11,o=r.maxA||1,l=r.numVar||["x"],a=r.excludeMultiples||[],i=r.randomDeg||!1,f=()=>Math.floor(Math.random()*(n-t))+t,s=f();if(a.length){let r=!0;for(;r;){let e=!1;for(let r=0;r<a.length;r++)for(let t=2;t<n;t++)s%t==0&&a[r]%t==0&&(e=!0);e?s=f():r=!1}}0==Math.floor(2*Math.random())&&(s*=-1);let p=[];if(i)for(let r=0;r<l.length;r++){let t=Math.floor(Math.random()*(e+1));p.push({variable:l[r],exponent:t})}else for(let r=0;r<l.length;r++)p.push({variable:l[r],exponent:e});let u={},m="";1===o&&(s=1),u.coeff=s,u.varArr=p,m+=s;for(let r=0;r<p.length;r+=1)m+=p[r].variable+supOpen+p[r].exponent+supClose;return{term:u,termFnc:m,termHtml:termToHtml(u),htmlToTerm:htmlToTerm}};export{termToHtml,htmlToTerm,reduceTerm,orderTermVariables,isTermsEquivalent,isTermsEqual,copyTerm,addTerms,mulTerms};