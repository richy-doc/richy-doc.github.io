import errors from"./errors.js";let supOpen="«",supClose="»";function isDigit(e){return/[-+\d]/.test(e)}function isLetter(e){return/[a-zA-Z]/.test(e)}function reduceHtml(e){let r="";r=e,r=r.replace(/&nbsp;/g,""),r=r.replace(/\s/g,"");let t="";for(;t!==r;)t=r,r=r.split("--").join("+"),r=r.split("++").join("+"),r=r.split("+-").join("-"),r=r.split("-+").join("-");return t}function htmlToTerm(e){let r="",t="",o="",n={},l="",a=!1,p=[];n.error="",r=reduceHtml(e),r=r.replace(/<sup>/gi,supOpen),r=r.replace(/<\/sup>/gi,supClose);let s=r.split("");return s.forEach(((e,r)=>{e===supOpen?a=!0:s[r-1]===supClose&&(a=!1,""!==o?(isNaN(Number(o))&&(n.error=errors.error_exponent(o)),p.push({variable:l,exponent:Number(o)})):p.push({variable:l,exponent:1}),o="",l=""),a?e!==supOpen&&e!==supClose&&(o+=e):isDigit(e)?t+=e:isLetter(e)&&(""!==l?(""!==o?(isNaN(Number(o))&&(n.error=errors.error_exponent(o)),p.push({variable:l,exponent:Number(o)})):p.push({variable:l,exponent:1}),l=e,o=""):(l=e,o=""))})),""!==l&&(""!==o?(isNaN(Number(o))&&(n.error=errors.error_exponent(o)),p.push({variable:l,exponent:Number(o)})):p.push({variable:l,exponent:1})),""===t&&0===p.length&&(n.error=errors.empty_char()),0===p.length&&p.push({variable:"x",exponent:0}),"-"===t&&(t=-1),""!==t&&"+"!==t||(t=1),n.coeff=Number(t),n.varArr=p,n}function termToHtml(e){let r="";if(0===e.coeff)return"0";1!==e.coeff&&(-1===e.coeff?r+="-":r+=e.coeff.toString());for(let t=0;t<e.varArr.length;t++){let o=e.varArr[t];0!==o.exponent&&(1===o.exponent?r+=`${o.variable}`:r+=`${o.variable}<sup>${o.exponent}</sup>`)}return"-"===r&&(r="-1"),""===r&&(r="1"),r}const GenTerm=e=>{let r=void 0===e.deg?1:e.deg,t=e.min||1,o=e.max||11,n=e.maxA||1,l=e.numVar||["x"],a=void 0===e.anPos||e.anPos,p=e.excludeMultiples||[],s=void 0!==e.randomDeg&&e.randomDeg,i=e.firstTerm||!1,u=()=>{let e;return e=i?Math.floor(Math.random()*(n-t))+t:Math.floor(Math.random()*(o-t))+t,e},f=u();if(p.length){let e=!0;for(;e;){let r=!1;for(let e=0;e<p.length;e++)for(let t=2;t<o;t++)f%t==0&&p[e]%t==0&&(r=!0);r?f=u():e=!1}}0==Math.floor(2*Math.random())&&(f*=-1);let m=[];if(s)for(let e=0;e<l.length;e++){let t=Math.floor(Math.random()*(r+1));i&&0===t&&(t=1),m.push({variable:l[e],exponent:t})}else for(let e=0;e<l.length;e++)m.push({variable:l[e],exponent:r});let h={},c="";a&&(f=Math.abs(f)),h.coeff=f,h.varArr=m,c+=f;for(let e=0;e<m.length;e+=1)c+=m[e].variable+supOpen+m[e].exponent+supClose;return{term:h,termFnc:c,termHtml:termToHtml(h)}};export{GenTerm};